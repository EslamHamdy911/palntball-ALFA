<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø³Ø§Ø­Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†: Paintball Arena</title>
    <style>
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #2c3e50; /* Ù„ÙˆÙ† Ø£Ø±Ø¶ÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ù„Ø¹Ø¨ */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„ØªØµØºÙŠØ± Ø¨Ø§Ù„Ù„Ù…Ø³ */
        }

        /* Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        canvas {
            display: block;
            background-color: #4b6cb7; /* Ù„ÙˆÙ† Ø£Ø±Ø¶ÙŠØ© Ø§Ù„Ù…Ù„Ø¹Ø¨ */
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UI) */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            pointer-events: auto;
            z-index: 10;
        }

        h1 { margin: 0 0 20px 0; color: #f1c40f; text-shadow: 2px 2px #000; font-size: 3rem; }
        p { font-size: 1.2rem; text-align: center; max-width: 80%; }
        
        .btn {
            padding: 15px 40px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px #c0392b;
            margin-top: 20px;
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 0 #c0392b; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        .controls {
            position: absolute;
            bottom: 20px;
            pointer-events: auto;
            z-index: 5;
        }

        /* Ø¹ØµØ§ Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„ÙŠØ³Ø§Ø±) */
        #joystick-zone {
            left: 20px;
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #joystick-knob {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            position: relative;
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ (Ø§Ù„ÙŠÙ…ÙŠÙ†) */
        #shoot-btn {
            right: 20px;
            width: 90px;
            height: 90px;
            background: rgba(231, 76, 60, 0.6);
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            user-select: none;
        }
        #shoot-btn:active { background: rgba(231, 76, 60, 0.9); }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© */
        #score-board {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-size: 1.2rem;
            display: flex;
            gap: 20px;
        }
        .score-blue { color: #3498db; font-weight: bold; }
        .score-red { color: #e74c3c; font-weight: bold; }

    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div id="start-screen">
            <h1>ğŸ¨ Splat Arena</h1>
            <p>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¨ÙŠÙ†ØªØ¨ÙˆÙ„ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø®ÙÙŠÙØ©.<br>ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±ØŒ ÙˆØ§Ø·Ù„Ù‚ Ø§Ù„Ù†Ø§Ø± Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ†.</p>
            <button class="btn" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div id="score-board" style="display:none;">
            <span class="score-blue">Ø£Ù†Øª: <span id="p-score">0</span></span>
            <span>|</span>
            <span class="score-red">Ø§Ù„Ø®ØµÙ…: <span id="e-score">0</span></span>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="controls" id="joystick-zone" style="display:none;">
            <div id="joystick-knob"></div>
        </div>
        <div class="controls" id="shoot-btn" style="display:none;">NAR</div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let gameRunning = false;
        let lastTime = 0;
        let bullets = [];
        let splats = []; // Ø¨Ù‚Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¡
        let obstacles = [];
        let particles = []; // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø± Ø§Ù„ØµØºÙŠØ±
        let score = { player: 0, enemy: 0 };

        // Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        class Entity {
            constructor(x, y, color, radius) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.radius = radius;
                this.angle = 0;
                this.speed = 0;
                this.isDead = false;
            }
        }

        // Ø§Ù„Ù„Ø§Ø¹Ø¨
        class Player extends Entity {
            constructor(x, y) {
                super(x, y, '#3498db', 20); // Ø£Ø²Ø±Ù‚
                this.maxSpeed = 4;
            }
            update(dx, dy) {
                this.x += dx * this.maxSpeed;
                this.y += dy * this.maxSpeed;
                
                // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
                this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));

                // Ø­Ø³Ø§Ø¨ Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø§Ù† (ÙŠÙ†Ø¸Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù„Ø£Ù‚Ø±Ø¨ Ø¹Ø¯Ùˆ Ø£Ùˆ Ù„Ù„Ø­Ø±ÙƒØ©)
                if (dx !== 0 || dy !== 0) {
                    this.angle = Math.atan2(dy, dx);
                }
            }
            draw() {
                drawCharacter(this.x, this.y, this.radius, this.color, this.angle, true);
            }
        }

        // Ø§Ù„Ø¹Ø¯Ùˆ (AI Ø¨Ø³ÙŠØ·)
        class Enemy extends Entity {
            constructor(x, y) {
                super(x, y, '#e74c3c', 20); // Ø£Ø­Ù…Ø±
                this.moveTimer = 0;
                this.moveDir = { x: 0, y: 0 };
                this.shootTimer = 0;
            }
            update(target) {
                // Ø­Ø±ÙƒØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ø¹ ØªØªØ¨Ø¹ Ø¨Ø³ÙŠØ·
                this.moveTimer++;
                if (this.moveTimer > 60) { // ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹
                    this.moveTimer = 0;
                    let angleToPlayer = Math.atan2(target.y - this.y, target.x - this.x);
                    // 50% ÙŠÙ„Ø­Ù‚ Ø§Ù„Ù„Ø§Ø¹Ø¨ØŒ 50% ÙŠØªØ­Ø±Ùƒ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                    if (Math.random() > 0.5) {
                        this.moveDir.x = Math.cos(angleToPlayer);
                        this.moveDir.y = Math.sin(angleToPlayer);
                    } else {
                        this.moveDir.x = (Math.random() - 0.5) * 2;
                        this.moveDir.y = (Math.random() - 0.5) * 2;
                    }
                }

                this.x += this.moveDir.x * 2;
                this.y += this.moveDir.y * 2;

                // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
                this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));

                // Ø§Ù„ØªØµÙˆÙŠØ¨ Ù†Ø­Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.angle = Math.atan2(target.y - this.y, target.x - this.x);

                // Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø±
                this.shootTimer++;
                if (this.shootTimer > 100) { // ÙŠØ·Ù„Ù‚ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© ÙˆÙ†ØµÙ
                    this.shootTimer = 0;
                    shootBullet(this, 'red');
                }
            }
            draw() {
                drawCharacter(this.x, this.y, this.radius, this.color, this.angle, false);
            }
        }

        // Ø§Ù„Ø­ÙƒÙ… (Referee)
        class Referee extends Entity {
            constructor() {
                super(canvas.width / 2, canvas.height / 2, '#fff', 18);
                this.timer = 0;
            }
            update() {
                this.timer += 0.02;
                this.x = (canvas.width / 2) + Math.sin(this.timer) * 100;
                this.y = (canvas.height / 2) + Math.cos(this.timer * 0.5) * 50;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = '#fff';
                ctx.fill();
                // Ø±Ø³Ù… Ø®Ø·ÙˆØ· Ø§Ù„Ø­ÙƒÙ…
                ctx.beginPath();
                for(let i=-this.radius; i<this.radius; i+=6) {
                    ctx.rect(i, -this.radius, 3, this.radius*2);
                }
                ctx.fillStyle = '#000';
                ctx.clip(); 
                ctx.fill();
                ctx.restore();
            }
        }

        // Ø§Ù„Ø±ØµØ§ØµØ©
        class Bullet {
            constructor(x, y, angle, ownerColor) {
                this.x = x;
                this.y = y;
                this.speed = 8;
                this.vx = Math.cos(angle) * this.speed;
                this.vy = Math.sin(angle) * this.speed;
                this.color = ownerColor === '#3498db' ? '#00ffff' : '#ffaaaa'; // Ø£Ù„ÙˆØ§Ù† ÙØ§ØªØ­Ø© Ù„Ù„Ø±ØµØ§Øµ
                this.radius = 5;
                this.active = true;
                this.ownerColor = ownerColor; // Ù„Ù…Ø¹Ø±ÙØ© Ù…Ù† Ø£Ø·Ù„Ù‚Ù‡Ø§
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.active = false;
                }
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª
        let player;
        let enemy;
        let referee;

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø³Ù… ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ---

        function drawCharacter(x, y, r, color, angle, isPlayer) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);

            // Ø§Ù„Ø¬Ø³Ù…
            ctx.beginPath();
            ctx.arc(0, 0, r, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Ø§Ù„Ù…Ø§Ø±ÙƒØ± (Ø§Ù„Ù…Ø³Ø¯Ø³)
            ctx.fillStyle = '#333';
            ctx.fillRect(r - 5, -5, 20, 10); // Ø´ÙƒÙ„ Ø§Ù„Ù…Ø³Ø¯Ø³
            ctx.fillStyle = 'orange'; // ÙÙˆÙ‡Ø©
            ctx.fillRect(r + 15, -5, 4, 10);

            // Ø§Ù„Ø®ÙˆØ°Ø© (visor)
            ctx.fillStyle = '#222';
            ctx.beginPath();
            ctx.ellipse(5, 0, 8, 12, 0, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();

            // Ø¯Ø§Ø¦Ø±Ø© ØªØ­Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„Ù„Ø¥Ø´Ø§Ø±Ø©
            if(isPlayer) {
                ctx.beginPath();
                ctx.arc(x, y, r + 5, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        function createSplat(x, y, color) {
            // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡: Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 30 Ø¨Ù‚Ø¹Ø© ÙÙ‚Ø·
            if (splats.length > 30) splats.shift();
            
            let splatCount = 5 + Math.random() * 5;
            let splatGroup = [];
            for(let i=0; i<splatCount; i++) {
                splatGroup.push({
                    ox: (Math.random() - 0.5) * 20,
                    oy: (Math.random() - 0.5) * 20,
                    size: 2 + Math.random() * 5
                });
            }
            splats.push({ x, y, color, shapes: splatGroup, alpha: 1.0 });
        }

        function drawSplats() {
            for (let s of splats) {
                ctx.globalAlpha = s.alpha;
                ctx.fillStyle = s.color;
                for (let shape of s.shapes) {
                    ctx.beginPath();
                    ctx.arc(s.x + shape.ox, s.y + shape.oy, shape.size, 0, Math.PI * 2);
                    ctx.fill();
                }
                s.alpha -= 0.0005; // ØªØªÙ„Ø§Ø´Ù‰ Ø¨Ø¨Ø·Ø¡
            }
            ctx.globalAlpha = 1.0;
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨Ù‚Ø¹ Ø§Ù„Ù…Ø®ØªÙÙŠØ©
            splats = splats.filter(s => s.alpha > 0);
        }

        function shootBullet(shooter, team) {
            let spread = (Math.random() - 0.5) * 0.2; // Ù‚Ù„ÙŠÙ„ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ø¯Ù‚Ø© Ù„Ù„ÙˆØ§Ù‚Ø¹ÙŠØ©
            bullets.push(new Bullet(shooter.x, shooter.y, shooter.angle + spread, shooter.color));
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­ÙƒÙ… (Joystick) ---
        let joystick = { active: false, dx: 0, dy: 0, originX: 0, originY: 0 };
        const joystickZone = document.getElementById('joystick-zone');
        const joystickKnob = document.getElementById('joystick-knob');

        joystickZone.addEventListener('touchstart', (e) => {
            e.preventDefault();
            let touch = e.changedTouches[0];
            joystick.active = true;
            joystick.originX = touch.clientX;
            joystick.originY = touch.clientY;
            joystickKnob.style.transition = 'none';
        }, {passive: false});

        joystickZone.addEventListener('touchmove', (e) => {
            if (!joystick.active) return;
            e.preventDefault();
            let touch = e.changedTouches[0];
            let dx = touch.clientX - joystick.originX;
            let dy = touch.clientY - joystick.originY;
            
            // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³Ø­Ø¨
            let distance = Math.min(40, Math.sqrt(dx*dx + dy*dy));
            let angle = Math.atan2(dy, dx);
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ù‚Ø¨Ø¶ Ø¨ØµØ±ÙŠØ§Ù‹
            let moveX = Math.cos(angle) * distance;
            let moveY = Math.sin(angle) * distance;
            joystickKnob.style.transform = `translate(${moveX}px, ${moveY}px)`;

            // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„Ø§Ø¹Ø¨ (ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… Ø¨ÙŠÙ† -1 Ùˆ 1)
            joystick.dx = moveX / 40;
            joystick.dy = moveY / 40;
        }, {passive: false});

        joystickZone.addEventListener('touchend', (e) => {
            e.preventDefault();
            joystick.active = false;
            joystick.dx = 0;
            joystick.dy = 0;
            joystickKnob.style.transform = `translate(0px, 0px)`;
            joystickKnob.style.transition = '0.2s';
        });

        // Ø²Ø± Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚
        document.getElementById('shoot-btn').addEventListener('touchstart', (e) => {
            e.preventDefault(); 
            if(gameRunning) shootBullet(player, 'blue');
        });

        // Ø¯Ø¹Ù… Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        let keys = {};
        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);
        window.addEventListener('keypress', e => {
            if(e.key === ' ' && gameRunning) shootBullet(player, 'blue');
        });

        // --- Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© (Game Loop) ---
        function init() {
            player = new Player(100, canvas.height / 2);
            enemy = new Enemy(canvas.width - 100, canvas.height / 2);
            referee = new Referee();
            bullets = [];
            splats = [];
            score = { player: 0, enemy: 0 };
            updateScore();
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('score-board').style.display = 'flex';
            document.getElementById('joystick-zone').style.display = 'flex';
            document.getElementById('shoot-btn').style.display = 'flex';
            init();
            gameRunning = true;
            loop();
        }

        function updateScore() {
            document.getElementById('p-score').innerText = score.player;
            document.getElementById('e-score').innerText = score.enemy;
        }

        function respawn(entity) {
            entity.x = Math.random() * (canvas.width - 100) + 50;
            entity.y = Math.random() * (canvas.height - 100) + 50;
        }

        function loop() {
            if (!gameRunning) return;
            requestAnimationFrame(loop);

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. Ø±Ø³Ù… Ø§Ù„Ø£Ø±Ø¶ÙŠØ© (Splats)
            drawSplats();

            // 2. ØªØ­Ø¯ÙŠØ« ÙˆØ±Ø³Ù… Ø§Ù„Ø­ÙƒÙ…
            referee.update();
            referee.draw();

            // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§Ø¹Ø¨
            let moveX = joystick.dx;
            let moveY = joystick.dy;
            // Ø¯Ø¹Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            if(keys['ArrowUp'] || keys['w']) moveY = -1;
            if(keys['ArrowDown'] || keys['s']) moveY = 1;
            if(keys['ArrowLeft'] || keys['a']) moveX = -1;
            if(keys['ArrowRight'] || keys['d']) moveX = 1;

            player.update(moveX, moveY);
            player.draw();

            // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ùˆ
            enemy.update(player);
            enemy.draw();

            // 5. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµØ§Øµ ÙˆØ§Ù„ØªØµØ§Ø¯Ù…
            for (let i = bullets.length - 1; i >= 0; i--) {
                let b = bullets[i];
                b.update();
                b.draw();

                // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
                let dxP = b.x - player.x;
                let dyP = b.y - player.y;
                if (b.ownerColor !== player.color && Math.sqrt(dxP*dxP + dyP*dyP) < player.radius + b.radius) {
                    createSplat(player.x, player.y, b.color);
                    score.enemy++;
                    updateScore();
                    respawn(player); // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø­ÙŠØ§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨
                    bullets.splice(i, 1);
                    continue;
                }

                // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø¹Ø¯Ùˆ
                let dxE = b.x - enemy.x;
                let dyE = b.y - enemy.y;
                if (b.ownerColor !== enemy.color && Math.sqrt(dxE*dxE + dyE*dyE) < enemy.radius + b.radius) {
                    createSplat(enemy.x, enemy.y, b.color);
                    score.player++;
                    updateScore();
                    respawn(enemy); // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø­ÙŠØ§Ø¡ Ø§Ù„Ø¹Ø¯Ùˆ
                    bullets.splice(i, 1);
                    continue;
                }
                
                // Ø­Ø°Ù Ø§Ù„Ø±ØµØ§Øµ Ø§Ù„Ù‚Ø¯ÙŠÙ…
                if (!b.active) bullets.splice(i, 1);
            }
        }

    </script>
</body>
</html>
